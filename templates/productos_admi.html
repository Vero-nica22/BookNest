<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Productos</title>
    <link rel="stylesheet" href="../static/productosadmstyle.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <header>
        <nav>
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo BookNest Coffee">
            <ul>
                <li><a href="#">Buscar libros</a></li>
                <li><a href="#">Libros</a></li>
                <li><a href="#">Reservas</a></li>
                <li><a href="/productos">Productos</a></li>
            </ul>
            <button class="cerrar-sesion">Cerrar sesión</button>
        </nav>
    </header>
    <button class="floating-button" id="openModal">+</button>

<div class="modal" id="productModal">
    <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2>Agregar Producto</h2>
        <form action="/productos" method="POST">
            <input type="text" name="nombre" placeholder="Nombre del producto" required>
            <textarea name="descripcion" placeholder="Descripción del producto" required></textarea>
            <input type="text" name="imagen_url" placeholder="URL de la imagen">
            <button type="submit">Agregar Producto</button>
        </form>
    </div>
</div>
<div class="modal" id="editModal">
    <div class="modal-content">
        <span class="close" id="closeEditModal">&times;</span>
        <h2>Editar Producto</h2>
        <form id="editForm" method="POST">
            <input type="text" name="nombre" id="editNombre" required>
            <textarea name="descripcion" id="editDescripcion" required></textarea>
            <input type="text" name="imagen_url" id="editImagen">
            <button type="submit">Actualizar Producto</button>
        </form>
    </div>
</div>
    <main>
        <h1>Productos</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="alert {{ messages[0][1] }}">
                    {{ messages[0][0] }}
                </div>
            {% endif %}
        {% endwith %}
        <section class="products">
            {% for producto in productos %}
            <div class="product">
                <h2>{{ producto.nombre }}</h2>
                <img src="{{ producto.imagen_url }}" alt="{{ producto.nombre }}" width="200px">
                <p>{{ producto.descripcion }}</p>
                
                <div class="botones-container">
                    <button class="edit-button"
                        data-id="{{ producto.id_producto }}"
                        data-nombre="{{ producto.nombre }}"
                        data-descripcion="{{ producto.descripcion }}"
                        data-imagen="{{ producto.imagen_url }}">
                        Editar
                    </button>
                    <form class="delete-form" data-id="{{ producto.id_producto }}">
                        <button type="submit" class="delete-button">Eliminar</button>
                    </form>
                </div>  
            </div>
            {% endfor %}
        </section>
    </main>
    <script>
        document.getElementById("openModal").addEventListener("click", function() {
            document.getElementById("productModal").style.display = "block";
        });
    
        document.getElementById("closeModal").addEventListener("click", function() {
            document.getElementById("productModal").style.display = "none";
        });
    
        window.addEventListener("click", function(event) {
            var modal = document.getElementById("productModal");
            if (event.target == modal) {
                modal.style.display = "none";
            }
        });
    </script>
    <script>
        
        window.addEventListener('DOMContentLoaded', function() {
            var alert = document.querySelector('.alert');
            if (alert) {
                setTimeout(function() {
                    alert.style.display = 'none';
                }, 3000); 
            }
        });
    </script>
    <script>
        document.querySelectorAll('.edit-button').forEach(button => {
            button.addEventListener('click', function () {
                const id = this.dataset.id;
                const nombre = this.dataset.nombre;
                const descripcion = this.dataset.descripcion;
                const imagen = this.dataset.imagen;
    
                
                document.getElementById('editNombre').value = nombre;
                document.getElementById('editDescripcion').value = descripcion;
                document.getElementById('editImagen').value = imagen;
    
                const form = document.getElementById('editForm');
                form.action = `/actualizar_producto/${id}`;
    
                
                document.getElementById('editModal').style.display = 'block';
            });
        });
    

        document.getElementById("closeEditModal").addEventListener("click", function() {
            document.getElementById("editModal").style.display = "none";
        });
    </script>
    
</body>
</html>
<script>
    document.querySelectorAll('.delete-form').forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault(); 

            Swal.fire({
                title: '¿Quieres eliminar el producto?',
                text: "¡No puedes revertir esta acción!",
                icon: 'warning',
                background: '#fff8e7',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#d4a373',
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
                
            }).then((result) => {
                if (result.isConfirmed) {
                    const id = form.getAttribute('data-id');
                    const tempForm = document.createElement('form');
                    tempForm.action = `/eliminar_producto/${id}`;
                    tempForm.method = 'POST';
                    document.body.appendChild(tempForm);
                    tempForm.submit();
                }
            });
        });
    });
</script>
